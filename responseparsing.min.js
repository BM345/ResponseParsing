function isAnyOf(e,t){return e.split("").filter(e=>e==t).length>0}class Marker{constructor(){this.position=0}}class ResponseParser{getParseResult(e){var t=new Marker,r=new Marker,n=new Marker,i=this.parseFraction(e,t),s=this.parseNumber(e,r),o=this.parseSquareRoot(e,n);return null!==i&&t.position==e.length?i:null!==s&&r.position==e.length?s:null!==o&&n.position==e.length?o:null}anyAt(e,t,r){for(var n=0;n<e.length;n++){var i=e[n];if(t.substring(r.position,r.position+i.length)==i)return i}return!1}parseSquareRoot(e,t){var r=t.position,n=this.anyAt(["sqrt","squareroot","root"],e,t);if(!1===n)return null;t.position+=n.length;var i=this.parseWhiteSpace(e,t);if("("!=e.charAt(t.position))return null;t.position+=1;var s=this.parseWhiteSpace(e,t),o=this.parseNumber(e,t),a=this.parseWhiteSpace(e,t);if(")"!=e.charAt(t.position))return null;t.position+=1;var l=t.position;return{type:"squareRoot",text:n+(null!==i?i.text:"")+"("+(null!==s?s.text:"")+o.text+(null!==a?a.text:"")+")",simplestForm:"sqrt("+o.simplestForm+")",latex:"\\sqrt{"+o.simplestForm+"}",start:r,end:l,length:l-r,number:o}}parseFraction(e,t){var r=t.position,n=this.parseNumber(e,t);if(null===n)return null;var i=this.parseWhiteSpace(e,t);if("/"!==e.charAt(t.position))return null;t.position+=1;var s=this.parseWhiteSpace(e,t),o=this.parseNumber(e,t),a=t.position,l=null!==o,u=n.text,p=null===i?"":i.text,c=null===s?"":s.text,h=null===o?"":o.text,m=n.simplestForm,g=null===o?"":o.simplestForm;return{type:"fraction",text:u+p+"/"+c+h,simplestForm:m+"/"+g,latex:"\\frac{"+m+"}{"+g+"}",start:r,end:a,length:a-r,isComplete:l,numerator:n,denominator:o}}parseNumber(e,t){var r="",n=t.position,i="",s="",o="",a="positive",l=!1,u=e.charAt(t.position);"+"==u?(o="+",l=!0,t.position++):"-"==u&&(o="-",a="negative",l=!0,t.position++);for(var p=0,c=0,h=0,m=0,g=0,f=0;t.position<e.length;){var v=e.charAt(t.position);if(isAnyOf("0123456789",v))r+=v,t.position++,0==f?i+=v:(s+=v,m++),"0"==v&&0==h&&0==f?p++:"0"!=v?(h+=g,g=0,h++):"0"==v&&h>0&&g++;else{if("."!=v)break;if(0!=f)break;r+=v,t.position++,s+=v,f++}}var b=0==h&&r.length>0;b&&(a="zero");var x=0,y=0;b?(x=1,y=1,f>0&&(c=m)):f>0?(x=h+g,y=h+g,c=g):(x=h,y=h+g);var d=t.position,w=0==f?"integer":"decimalNumber",k="";k=""!=i||""!=s&&"."!=s?""==i?"0":""==(k=i.slice(p))?"0":k:"";var A="."==s?"":s,S=b?k+A:o+k+A;return o+r==""?null:{type:"number",subtype:w,text:o+r,integralPart:i,decimalPart:s,simplestForm:S,latex:S,start:n,end:d,length:d-n,sign:a,signIsExplicit:l,numberOfLeadingZeros:p,numberOfTrailingZeros:c,minimumNumberOfSignificantFigures:x,maximumNumberOfSignificantFigures:y,numberOfDecimalPlaces:m}}parseWhiteSpace(e,t){for(var r="",n=t.position;t.position<e.length;){var i=e.charAt(t.position);if(!isAnyOf(" \t\n",i))break;r+=i,t.position+=1}var s=t.position;return""==r?null:{type:"whiteSpace",text:r,latex:r,start:n,end:s,length:r.length,compressedWhiteSpace:" "}}}class Validator{constructor(){this.inputs=[],this.rp=new ResponseParser,this.controlKeys=["ShiftLeft","ShiftRight","Backspace","Enter","Tab","CapsLock","MetaLeft","MetaRight","AltLeft","AltRight","ControlLeft","ControlRight","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Escape"]}getNewInputValueOnKeyDown(e,t){var r=e.value.length;return e.selectionStart==r&&e.selectionEnd==r?e.value+t.key:e.value.slice(0,e.selectionStart)+t.key+e.value.slice(e.selectionEnd,r)}addInput(e,t,r,n,i){this.inputs.push([e,t,r,n,i]);var s=this;e.onkeydown=function(n){if(0==s.controlKeys.filter(e=>n.code==e).length){var i=s.getNewInputValueOnKeyDown(e,n),o=s.rp.getParseResult(i);if(console.log(i),console.log(o),null===o)return void n.preventDefault();"integer"!=t||"number"==o.type&&"integer"==o.subtype||n.preventDefault(),"decimalNumber"==t&&"number"!=o.type&&n.preventDefault(),"fraction"==t&&"fraction"!=o.type&&"number"!=o.type&&n.preventDefault(),null!==o?katex.render(o.latex,r):katex.render("",r)}},e.onkeyup=function(t){n.innerText="";var i=s.rp.getParseResult(e.value);null!==i?katex.render(i.latex,r):katex.render("",r)},i.onmousedown=function(r){var i=e.value,o=s.rp.getParseResult(i);console.log(i),console.log(o),n.innerText="","integer"==t&&(null===o||"number"!=o.type&&"integer"==o.subtype)&&(n.innerText="Your answer must be a whole number."),"decimalNumber"!=t||null!==o&&"number"==o.type||(n.innerText="Your answer must be a decimal number or a whole number.")}}}