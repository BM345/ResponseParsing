class RPNode{constructor(){this.supernode=null,this.depth=0,this.type="",this.subtype="",this.text="",this.latex="",this.asciiMath="",this.isComplete=!1,this.start=0,this.end=0}get length(){return this.end-this.start}get subnodes(){return[]}setDepth(e=0){this.depth=e;var t=this;this.subnodes.forEach(i=>{i.supernode=t,i.setDepth(e+1)})}}class RPNumberNode extends RPNode{constructor(){super(),this.type="number",this.integralPart="",this.decimalPart="",this.sign="",this.signIsExplicit=!1,this.numberOfLeadingZeros=0,this.numberOfTrailingZeros=0,this.minimumNumberOfSignificantFigures=0,this.maximumNumberOfSignificantFigures=0,this.numberOfDecimalPlaces=0}}class RPFractionNode extends RPNode{constructor(){super(),this.type="fraction",this.numerator=null,this.denominator=null}get subnodes(){return[this.numerator,this.denominator]}}class RPMixedFractionNode extends RPNode{constructor(){super(),this.type="mixedFraction",this.wholePart=null,this.fractionPart=null}get subnodes(){return[this.wholePart,this.fractionPart]}}class RPRadicalNode extends RPNode{constructor(){super(),this.type="radical",this.radix=2,this.radixIsImplicit=!0,this.radicand=null}get subnodes(){return[this.radicand]}}function isAnyOf(e,t){return e.split("").filter(e=>e==t).length>0}class Marker{constructor(){this.position=0}}class ParserSettings{constructor(){this.removeLeadingZerosFromSimplifiedForms=!1,this.addLeadingZeroToDecimalsForSimplifiedForms=!0}}class ResponseParser{constructor(){this.settings=new ParserSettings}getParseResult(e){var t=new Marker,i=new Marker,r=new Marker,n=new Marker,s=this.parseFraction(e,t),a=this.parseNumber(e,i),o=this.parseSquareRoot(e,r),l=this.parseMixedFraction(e,n);return null!==s&&t.position==e.length?s:null!==a&&i.position==e.length?a:null!==o&&r.position==e.length?o:null!==l&&n.position==e.length?l:null}anyAt(e,t,i){for(var r=0;r<e.length;r++){var n=e[r];if(t.substring(i.position,i.position+n.length)==n)return n}return!1}parseSquareRoot(e,t){var i=t.position,r=this.anyAt(["sqrt","squareroot","root"],e,t);if(!1===r)return null;t.position+=r.length;var n=this.parseWhiteSpace(e,t);if("("!=e.charAt(t.position))return null;t.position+=1;var s=this.parseWhiteSpace(e,t),a=this.parseNumber(e,t),o=this.parseWhiteSpace(e,t);if(")"!=e.charAt(t.position))return null;t.position+=1;var l=t.position,u=r,p=null!==n?n.text:"",h=null!==s?s.text:"",c=a.text,d=null!==o?o.text:"",m=new RPRadicalNode;return m.text=u+p+"("+h+c+d+")",m.latex="\\sqrt{"+a.simplestForm+"}",m.asciiMath="sqrt("+a.simplestForm+")",m.start=i,m.end=l,m.radix=2,m.radixIsImplicit=!0,m.radicand=a,m}parseMixedFraction(e,t){var i=t.position,r=this.parseNumber(e,t);if(null===r)return null;var n=this.parseWhiteSpace(e,t);if(null===n)return null;var s=this.parseFraction(e,t);if(null===s)return null;var a=t.position,o=new RPMixedFractionNode;return o.text=r.text+n.text+s.text,o.latex=r.latex+" "+s.latex,o.asciiMath=r.asciiMath+" "+s.asciiMath,o.start=i,o.end=a,o.wholePart=r,o.fractionPart=s,o}parseFraction(e,t){var i=t.position,r=this.parseNumber(e,t);if(null===r)return null;var n=this.parseWhiteSpace(e,t);if("/"!==e.charAt(t.position))return null;t.position+=1;var s=this.parseWhiteSpace(e,t),a=this.parseNumber(e,t),o=t.position,l=null!==a,u=r.text,p=null===n?"":n.text,h=null===s?"":s.text,c=null===a?"":a.text,d=r.simplestForm,m=null===a?"":a.simplestForm,g=new RPFractionNode;return g.text=u+p+"/"+h+c,g.latex="\\frac{"+d+"}{"+m+"}",g.asciiMath="frac "+d+" "+m,g.start=i,g.end=o,g.isComplete=l,g.numerator=r,g.denominator=a,g}parseNumber(e,t){var i="",r=t.position,n="",s="",a="",o="positive",l=!1,u=e.charAt(t.position);"+"==u?(a="+",l=!0,t.position++):"-"==u&&(a="-",o="negative",l=!0,t.position++);for(var p=0,h=0,c=0,d=0,m=0,g=0;t.position<e.length;){var f=e.charAt(t.position);if(isAnyOf("0123456789",f))i+=f,t.position++,0==g?n+=f:(s+=f,d++),"0"==f&&0==c&&0==g?p++:"0"!=f?(c+=m,m=0,c++):"0"==f&&c>0&&m++;else{if("."!=f)break;if(0!=g)break;i+=f,t.position++,s+=f,g++}}var x=0==c&&i.length>0;x&&(o="zero");var b=0,v=0;x?(b=1,v=1,g>0&&(h=d)):g>0?(b=c+m,v=c+m,h=m):(b=c,v=c+m);var P=t.position,N=0==g?"integer":"decimalNumber",w="";""!=n||""!=s&&"."!=s?""==n?w=this.settings.addLeadingZeroToDecimalsForSimplifiedForms?"0":"":this.settings.removeLeadingZerosFromSimplifiedForms?(w=n.slice(p),this.settings.addLeadingZeroToDecimalsForSimplifiedForms&&(w=""==w?"0":w)):w=n:w="";var y="."==s?"":s,F=x?w+y:a+w+y;if(a+i=="")return null;var R=new RPNumberNode;return R.subtype=N,R.text=a+i,R.integralPart=n,R.decimalPart=s,R.latex=F,R.asciiMath=F,R.start=r,R.end=P,R.sign=o,R.signIsExplicit=l,R.numberOfLeadingZeros=p,R.numberOfTrailingZeros=h,R.minimumNumberOfSignificantFigures=b,R.maximumNumberOfSignificantFigures=v,R.numberOfDecimalPlaces=d,R}parseWhiteSpace(e,t){for(var i="",r=t.position;t.position<e.length;){var n=e.charAt(t.position);if(!isAnyOf(" \t\n",n))break;i+=n,t.position+=1}var s=t.position;return""==i?null:{type:"whiteSpace",text:i,latex:i,asciiMath:i,start:r,end:s,length:i.length,compressedWhiteSpace:" "}}}class Validator{constructor(){this.inputs=[],this.rp=new ResponseParser,this.controlKeys=["ShiftLeft","ShiftRight","Backspace","Enter","Tab","CapsLock","MetaLeft","MetaRight","AltLeft","AltRight","ControlLeft","ControlRight","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Escape"]}getNewInputValueOnKeyDown(e,t){var i=e.value.length;return e.selectionStart==i&&e.selectionEnd==i?e.value+t.key:e.value.slice(0,e.selectionStart)+t.key+e.value.slice(e.selectionEnd,i)}addInput(e,t,i,r,n){this.inputs.push([e,t,i,r,n]);var s=this;e.onkeydown=function(r){if(0==s.controlKeys.filter(e=>r.code==e).length){var n=s.getNewInputValueOnKeyDown(e,r),a=s.rp.getParseResult(n);if(console.log(n),console.log(a),null===a)return void r.preventDefault();"integer"!=t||"number"==a.type&&"integer"==a.subtype||r.preventDefault(),"decimalNumber"==t&&"number"!=a.type&&r.preventDefault(),"fraction"==t&&"fraction"!=a.type&&"number"!=a.type&&r.preventDefault(),null!==a?katex.render(a.latex,i):katex.render("",i)}},e.onkeyup=function(t){r.innerText="";var n=s.rp.getParseResult(e.value);null!==n?katex.render(n.latex,i):katex.render("",i)},n.onmousedown=function(i){var n=e.value,a=s.rp.getParseResult(n);console.log(n),console.log(a),r.innerText="","integer"==t&&(null===a||"number"!=a.type&&"integer"==a.subtype)&&(r.innerText="Your answer must be a whole number."),"decimalNumber"!=t||null!==a&&"number"==a.type||(r.innerText="Your answer must be a decimal number or a whole number.")}}}