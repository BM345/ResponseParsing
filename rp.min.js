function isAnyOf(e,t){return e.split("").filter(e=>e==t).length>0}class Marker{constructor(){this.position=0}}class ParserSettings{constructor(){this.removeLeadingZerosFromSimplifiedForms=!1,this.addLeadingZeroToDecimalsForSimplifiedForms=!0}}class ResponseParser{constructor(){this.settings=new ParserSettings}getParseResult(e){var t=new Marker,r=new Marker,i=new Marker,n=new Marker,s=this.parseFraction(e,t),a=this.parseNumber(e,r),o=this.parseSquareRoot(e,i),l=this.parseMixedFraction(e,n);return null!==s&&t.position==e.length?s:null!==a&&r.position==e.length?a:null!==o&&i.position==e.length?o:null!==l&&n.position==e.length?l:null}anyAt(e,t,r){for(var i=0;i<e.length;i++){var n=e[i];if(t.substring(r.position,r.position+n.length)==n)return n}return!1}parseSquareRoot(e,t){var r=t.position,i=this.anyAt(["sqrt","squareroot","root"],e,t);if(!1===i)return null;t.position+=i.length;var n=this.parseWhiteSpace(e,t);if("("!=e.charAt(t.position))return null;t.position+=1;var s=this.parseWhiteSpace(e,t),a=this.parseNumber(e,t),o=this.parseWhiteSpace(e,t);if(")"!=e.charAt(t.position))return null;t.position+=1;var l=t.position;return{type:"squareRoot",text:i+(null!==n?n.text:"")+"("+(null!==s?s.text:"")+a.text+(null!==o?o.text:"")+")",simplestForm:"sqrt("+a.simplestForm+")",latex:"\\sqrt{"+a.simplestForm+"}",asciiMath:"sqrt("+a.simplestForm+")",start:r,end:l,length:l-r,number:a}}parseMixedFraction(e,t){var r=t.position,i=this.parseNumber(e,t);if(null===i)return null;var n=this.parseWhiteSpace(e,t);if(null===n)return null;var s=this.parseFraction(e,t);if(null===s)return null;var a=t.position;return{type:"mixedFraction",text:i.text+n.text+s.text,simplestForm:i.simplestForm+" "+s.simplestForm,latex:i.latex+" "+s.latex,asciiMath:i.asciiMath+" "+s.asciiMath,start:r,end:a,length:a-r,wholePart:i,fractionPart:s}}parseFraction(e,t){var r=t.position,i=this.parseNumber(e,t);if(null===i)return null;var n=this.parseWhiteSpace(e,t);if("/"!==e.charAt(t.position))return null;t.position+=1;var s=this.parseWhiteSpace(e,t),a=this.parseNumber(e,t),o=t.position,l=null!==a,u=i.text,p=null===n?"":n.text,m=null===s?"":s.text,c=null===a?"":a.text,h=i.simplestForm,g=null===a?"":a.simplestForm;return{type:"fraction",text:u+p+"/"+m+c,simplestForm:h+"/"+g,latex:"\\frac{"+h+"}{"+g+"}",asciiMath:"frac "+h+" "+g,start:r,end:o,length:o-r,isComplete:l,numerator:i,denominator:a}}parseNumber(e,t){var r="",i=t.position,n="",s="",a="",o="positive",l=!1,u=e.charAt(t.position);"+"==u?(a="+",l=!0,t.position++):"-"==u&&(a="-",o="negative",l=!0,t.position++);for(var p=0,m=0,c=0,h=0,g=0,f=0;t.position<e.length;){var d=e.charAt(t.position);if(isAnyOf("0123456789",d))r+=d,t.position++,0==f?n+=d:(s+=d,h++),"0"==d&&0==c&&0==f?p++:"0"!=d?(c+=g,g=0,c++):"0"==d&&c>0&&g++;else{if("."!=d)break;if(0!=f)break;r+=d,t.position++,s+=d,f++}}var v=0==c&&r.length>0;v&&(o="zero");var x=0,b=0;v?(x=1,b=1,f>0&&(m=h)):f>0?(x=c+g,b=c+g,m=g):(x=c,b=c+g);var F=t.position,y=0==f?"integer":"decimalNumber",S="";""!=n||""!=s&&"."!=s?""==n?S=this.settings.addLeadingZeroToDecimalsForSimplifiedForms?"0":"":this.settings.removeLeadingZerosFromSimplifiedForms?(S=n.slice(p),this.settings.addLeadingZeroToDecimalsForSimplifiedForms&&(S=""==S?"0":S)):S=n:S="";var w="."==s?"":s,k=v?S+w:a+S+w;return a+r==""?null:{type:"number",subtype:y,text:a+r,integralPart:n,decimalPart:s,simplestForm:k,latex:k,asciiMath:k,start:i,end:F,length:F-i,sign:o,signIsExplicit:l,numberOfLeadingZeros:p,numberOfTrailingZeros:m,minimumNumberOfSignificantFigures:x,maximumNumberOfSignificantFigures:b,numberOfDecimalPlaces:h}}parseWhiteSpace(e,t){for(var r="",i=t.position;t.position<e.length;){var n=e.charAt(t.position);if(!isAnyOf(" \t\n",n))break;r+=n,t.position+=1}var s=t.position;return""==r?null:{type:"whiteSpace",text:r,latex:r,asciiMath:r,start:i,end:s,length:r.length,compressedWhiteSpace:" "}}}class Validator{constructor(){this.inputs=[],this.rp=new ResponseParser,this.controlKeys=["ShiftLeft","ShiftRight","Backspace","Enter","Tab","CapsLock","MetaLeft","MetaRight","AltLeft","AltRight","ControlLeft","ControlRight","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Escape"]}getNewInputValueOnKeyDown(e,t){var r=e.value.length;return e.selectionStart==r&&e.selectionEnd==r?e.value+t.key:e.value.slice(0,e.selectionStart)+t.key+e.value.slice(e.selectionEnd,r)}addInput(e,t,r,i,n){this.inputs.push([e,t,r,i,n]);var s=this;e.onkeydown=function(i){if(0==s.controlKeys.filter(e=>i.code==e).length){var n=s.getNewInputValueOnKeyDown(e,i),a=s.rp.getParseResult(n);if(console.log(n),console.log(a),null===a)return void i.preventDefault();"integer"!=t||"number"==a.type&&"integer"==a.subtype||i.preventDefault(),"decimalNumber"==t&&"number"!=a.type&&i.preventDefault(),"fraction"==t&&"fraction"!=a.type&&"number"!=a.type&&i.preventDefault(),null!==a?katex.render(a.latex,r):katex.render("",r)}},e.onkeyup=function(t){i.innerText="";var n=s.rp.getParseResult(e.value);null!==n?katex.render(n.latex,r):katex.render("",r)},n.onmousedown=function(r){var n=e.value,a=s.rp.getParseResult(n);console.log(n),console.log(a),i.innerText="","integer"==t&&(null===a||"number"!=a.type&&"integer"==a.subtype)&&(i.innerText="Your answer must be a whole number."),"decimalNumber"!=t||null!==a&&"number"==a.type||(i.innerText="Your answer must be a decimal number or a whole number.")}}}