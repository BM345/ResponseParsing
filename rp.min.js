class RPNode{constructor(){this.supernode=null,this.depth=0,this.type="",this.subtype="",this.text="",this.latex="",this.asciiMath="",this.isComplete=!1,this.start=0,this.end=0}get length(){return this.end-this.start}get subnodes(){return[]}setDepth(t=0){this.depth=t;var e=this;this.subnodes.forEach(i=>{i.supernode=e,i.setDepth(t+1)})}}class RPNumberNode extends RPNode{constructor(){super(),this.type="number",this.integralPart="",this.decimalPart="",this.sign="",this.signIsExplicit=!1,this.numberOfLeadingZeros=0,this.numberOfTrailingZeros=0,this.minimumNumberOfSignificantFigures=0,this.maximumNumberOfSignificantFigures=0,this.numberOfDecimalPlaces=0}}class RPFractionNode extends RPNode{constructor(){super(),this.type="fraction",this.numerator=null,this.denominator=null}get subnodes(){return[this.numerator,this.denominator]}}class RPMixedFractionNode extends RPNode{constructor(){super(),this.type="mixedFraction",this.wholePart=null,this.fractionPart=null}get subnodes(){return[this.wholePart,this.fractionPart]}}class RPRadicalNode extends RPNode{constructor(){super(),this.type="radical",this.radix=2,this.radixIsImplicit=!0,this.radicand=null}get subnodes(){return[this.radicand]}}function isAnyOf(t,e){return t.split("").filter(t=>t==e).length>0}class Marker{constructor(){this.position=0}}class ParserSettings{constructor(){this.removeLeadingZerosFromSimplifiedForms=!1,this.addLeadingZeroToDecimalsForSimplifiedForms=!0}}class ResponseParser{constructor(){this.settings=new ParserSettings}getParseResult(t){var e=new Marker,i=new Marker,r=new Marker,n=new Marker,s=this.parseFraction(t,e),a=this.parseNumber(t,i),o=this.parseSquareRoot(t,r),l=this.parseMixedFraction(t,n);return null!==s&&e.position==t.length?(s.setDepth(),s):null!==a&&i.position==t.length?(a.setDepth(),a):null!==o&&r.position==t.length?(o.setDepth(),o):null!==l&&n.position==t.length?(l.setDepth(),l):null}anyAt(t,e,i){for(var r=0;r<t.length;r++){var n=t[r];if(e.substring(i.position,i.position+n.length)==n)return n}return!1}parseSquareRoot(t,e){var i=e.position,r=this.anyAt(["sqrt","squareroot","root"],t,e);if(!1===r)return null;e.position+=r.length;var n=this.parseWhiteSpace(t,e);if("("!=t.charAt(e.position))return null;e.position+=1;var s=this.parseWhiteSpace(t,e),a=this.parseNumber(t,e),o=this.parseWhiteSpace(t,e);if(")"!=t.charAt(e.position))return null;e.position+=1;var l=e.position,u=r,h=null!==n?n.text:"",p=null!==s?s.text:"",c=a.text,d=null!==o?o.text:"",m=new RPRadicalNode;return m.text=u+h+"("+p+c+d+")",m.latex="\\sqrt{"+a.latex+"}",m.asciiMath="sqrt("+a.asciiMath+")",m.start=i,m.end=l,m.radix=2,m.radixIsImplicit=!0,m.radicand=a,m}parseMixedFraction(t,e){var i=e.position,r=this.parseNumber(t,e);if(null===r)return null;var n=this.parseWhiteSpace(t,e);if(null===n)return null;var s=this.parseFraction(t,e);if(null===s)return null;var a=e.position,o=new RPMixedFractionNode;return o.text=r.text+n.text+s.text,o.latex=r.latex+" "+s.latex,o.asciiMath=r.asciiMath+" "+s.asciiMath,o.start=i,o.end=a,o.wholePart=r,o.fractionPart=s,o}parseFraction(t,e){var i=e.position,r=this.parseNumber(t,e);if(null===r)return null;var n=this.parseWhiteSpace(t,e);if("/"!==t.charAt(e.position))return null;e.position+=1;var s=this.parseWhiteSpace(t,e),a=this.parseNumber(t,e),o=e.position,l=null!==a,u=r.text,h=null===n?"":n.text,p=null===s?"":s.text,c=null===a?"":a.text,d=(r.simplestForm,null===a||a.simplestForm,new RPFractionNode);return d.text=u+h+"/"+p+c,d.latex="\\frac{"+r.latex+"}{"+a.latex+"}",d.asciiMath="frac "+r.asciiMath+" "+a.asciiMath,d.start=i,d.end=o,d.isComplete=l,d.numerator=r,d.denominator=a,d}parseNumber(t,e){var i="",r=e.position,n="",s="",a="",o="positive",l=!1,u=t.charAt(e.position);"+"==u?(a="+",l=!0,e.position++):"-"==u&&(a="-",o="negative",l=!0,e.position++);for(var h=0,p=0,c=0,d=0,m=0,g=0;e.position<t.length;){var f=t.charAt(e.position);if(isAnyOf("0123456789",f))i+=f,e.position++,0==g?n+=f:(s+=f,d++),"0"==f&&0==c&&0==g?h++:"0"!=f?(c+=m,m=0,c++):"0"==f&&c>0&&m++;else{if("."!=f)break;if(0!=g)break;i+=f,e.position++,s+=f,g++}}var x=0==c&&i.length>0;x&&(o="zero");var b=0,v=0;x?(b=1,v=1,g>0&&(p=d)):g>0?(b=c+m,v=c+m,p=m):(b=c,v=c+m);var P=e.position,N=0==g?"integer":"decimalNumber",w="";""!=n||""!=s&&"."!=s?""==n?w=this.settings.addLeadingZeroToDecimalsForSimplifiedForms?"0":"":this.settings.removeLeadingZerosFromSimplifiedForms?(w=n.slice(h),this.settings.addLeadingZeroToDecimalsForSimplifiedForms&&(w=""==w?"0":w)):w=n:w="";var y="."==s?"":s,R=x?w+y:a+w+y;if(a+i=="")return null;var F=new RPNumberNode;return F.subtype=N,F.text=a+i,F.integralPart=n,F.decimalPart=s,F.latex=R,F.asciiMath=R,F.start=r,F.end=P,F.sign=o,F.signIsExplicit=l,F.numberOfLeadingZeros=h,F.numberOfTrailingZeros=p,F.minimumNumberOfSignificantFigures=b,F.maximumNumberOfSignificantFigures=v,F.numberOfDecimalPlaces=d,F}parseWhiteSpace(t,e){for(var i="",r=e.position;e.position<t.length;){var n=t.charAt(e.position);if(!isAnyOf(" \t\n",n))break;i+=n,e.position+=1}var s=e.position;return""==i?null:{type:"whiteSpace",text:i,latex:i,asciiMath:i,start:r,end:s,length:i.length,compressedWhiteSpace:" "}}}class Validator{constructor(){this.inputs=[],this.rp=new ResponseParser,this.controlKeys=["ShiftLeft","ShiftRight","Backspace","Enter","Tab","CapsLock","MetaLeft","MetaRight","AltLeft","AltRight","ControlLeft","ControlRight","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Escape"]}getNewInputValueOnKeyDown(t,e){var i=t.value.length;return t.selectionStart==i&&t.selectionEnd==i?t.value+e.key:t.value.slice(0,t.selectionStart)+e.key+t.value.slice(t.selectionEnd,i)}addInput(t,e,i,r,n){this.inputs.push([t,e,i,r,n]);var s=this;t.onkeydown=function(r){if(0==s.controlKeys.filter(t=>r.code==t).length){var n=s.getNewInputValueOnKeyDown(t,r),a=s.rp.getParseResult(n);if(console.log(n),console.log(a),null===a)return void r.preventDefault();"integer"!=e||"number"==a.type&&"integer"==a.subtype||r.preventDefault(),"decimalNumber"==e&&"number"!=a.type&&r.preventDefault(),"fraction"==e&&"fraction"!=a.type&&"number"!=a.type&&r.preventDefault(),null!==a?katex.render(a.latex,i):katex.render("",i)}},t.onkeyup=function(e){r.innerText="";var n=s.rp.getParseResult(t.value);null!==n?katex.render(n.latex,i):katex.render("",i)},n.onmousedown=function(i){var n=t.value,a=s.rp.getParseResult(n);console.log(n),console.log(a),r.innerText="","integer"==e&&(null===a||"number"!=a.type&&"integer"==a.subtype)&&(r.innerText="Your answer must be a whole number."),"decimalNumber"!=e||null!==a&&"number"==a.type||(r.innerText="Your answer must be a decimal number or a whole number.")}}}